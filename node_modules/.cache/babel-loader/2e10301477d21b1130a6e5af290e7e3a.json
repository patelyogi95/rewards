{"ast":null,"code":"// ag-grid-enterprise v20.2.0\n\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ag_grid_community_1 = require(\"ag-grid-community\");\n\nvar aggFuncService_1 = require(\"../../../../aggregation/aggFuncService\");\n\nvar virtualList_1 = require(\"../../../../rendering/virtualList\");\n\nvar DropZoneColumnComp =\n/** @class */\nfunction (_super) {\n  __extends(DropZoneColumnComp, _super);\n\n  function DropZoneColumnComp(column, dragSourceDropTarget, ghost, valueColumn) {\n    var _this = _super.call(this) || this;\n\n    _this.popupShowing = false;\n    _this.valueColumn = valueColumn;\n    _this.column = column;\n    _this.dragSourceDropTarget = dragSourceDropTarget;\n    _this.ghost = ghost;\n    return _this;\n  }\n\n  DropZoneColumnComp.prototype.init = function () {\n    this.setTemplate(DropZoneColumnComp.TEMPLATE);\n    this.displayName = this.columnController.getDisplayNameForColumn(this.column, 'columnDrop');\n    this.setupComponents();\n\n    if (!this.ghost && !this.gridOptionsWrapper.isFunctionsReadOnly()) {\n      this.addDragSource();\n    }\n  };\n\n  DropZoneColumnComp.prototype.addDragSource = function () {\n    var _this = this;\n\n    var dragSource = {\n      type: ag_grid_community_1.DragSourceType.ToolPanel,\n      eElement: this.eDragHandle,\n      dragItemCallback: function dragItemCallback() {\n        return _this.createDragItem();\n      },\n      dragItemName: this.displayName,\n      dragSourceDropTarget: this.dragSourceDropTarget\n    };\n    this.dragAndDropService.addDragSource(dragSource, true);\n    this.addDestroyFunc(function () {\n      return _this.dragAndDropService.removeDragSource(dragSource);\n    });\n  };\n\n  DropZoneColumnComp.prototype.createDragItem = function () {\n    var visibleState = {};\n    visibleState[this.column.getId()] = this.column.isVisible();\n    return {\n      columns: [this.column],\n      visibleState: visibleState\n    };\n  };\n\n  DropZoneColumnComp.prototype.setupComponents = function () {\n    this.setTextValue();\n    this.setupRemove();\n\n    if (this.ghost) {\n      ag_grid_community_1._.addCssClass(this.getGui(), 'ag-column-drop-cell-ghost');\n    }\n\n    if (this.valueColumn && !this.gridOptionsWrapper.isFunctionsReadOnly()) {\n      this.addGuiEventListener('click', this.onShowAggFuncSelection.bind(this));\n    }\n  };\n\n  DropZoneColumnComp.prototype.setupRemove = function () {\n    var _this = this;\n\n    ag_grid_community_1._.setVisible(this.btRemove, !this.gridOptionsWrapper.isFunctionsReadOnly());\n\n    this.addDestroyableEventListener(this.btRemove, 'click', function (mouseEvent) {\n      var agEvent = {\n        type: DropZoneColumnComp.EVENT_COLUMN_REMOVE\n      };\n\n      _this.dispatchEvent(agEvent);\n\n      mouseEvent.stopPropagation();\n    });\n    var touchListener = new ag_grid_community_1.TouchListener(this.btRemove);\n    this.addDestroyableEventListener(touchListener, ag_grid_community_1.TouchListener.EVENT_TAP, function (event) {\n      var agEvent = {\n        type: DropZoneColumnComp.EVENT_COLUMN_REMOVE\n      };\n\n      _this.dispatchEvent(agEvent);\n    });\n    this.addDestroyFunc(touchListener.destroy.bind(touchListener));\n  };\n\n  DropZoneColumnComp.prototype.setTextValue = function () {\n    var displayValue;\n\n    if (this.valueColumn) {\n      var aggFunc = this.column.getAggFunc(); // if aggFunc is a string, we can use it, but if it's a function, then we swap with 'func'\n\n      var aggFuncString = typeof aggFunc === 'string' ? aggFunc : 'agg';\n      var localeTextFunc = this.gridOptionsWrapper.getLocaleTextFunc();\n      var aggFuncStringTranslated = localeTextFunc(aggFuncString, aggFuncString);\n      displayValue = aggFuncStringTranslated + \"(\" + this.displayName + \")\";\n    } else {\n      displayValue = this.displayName;\n    }\n\n    var displayValueSanitised = ag_grid_community_1._.escape(displayValue);\n\n    this.eText.innerHTML = displayValueSanitised;\n  };\n\n  DropZoneColumnComp.prototype.onShowAggFuncSelection = function () {\n    var _this = this;\n\n    if (this.popupShowing) {\n      return;\n    }\n\n    this.popupShowing = true;\n    var virtualList = new virtualList_1.VirtualList();\n    var rows = this.aggFuncService.getFuncNames(this.column);\n    virtualList.setModel({\n      getRow: function getRow(index) {\n        return rows[index];\n      },\n      getRowCount: function getRowCount() {\n        return rows.length;\n      }\n    });\n    this.getContext().wireBean(virtualList);\n\n    var ePopup = ag_grid_community_1._.loadTemplate('<div class=\"ag-select-agg-func-popup\"></div>');\n\n    ePopup.style.top = '0px';\n    ePopup.style.left = '0px';\n    ePopup.appendChild(virtualList.getGui()); // ePopup.style.height = this.gridOptionsWrapper.getAggFuncPopupHeight() + 'px';\n\n    ePopup.style.width = this.getGui().clientWidth + 'px';\n\n    var popupHiddenFunc = function popupHiddenFunc() {\n      virtualList.destroy();\n      _this.popupShowing = false;\n    };\n\n    var hidePopup = this.popupService.addAsModalPopup(ePopup, true, popupHiddenFunc);\n    virtualList.setComponentCreator(this.createAggSelect.bind(this, hidePopup));\n    this.popupService.positionPopupUnderComponent({\n      type: 'aggFuncSelect',\n      eventSource: this.getGui(),\n      ePopup: ePopup,\n      keepWithinBounds: true,\n      column: this.column\n    });\n    virtualList.refresh();\n  };\n\n  DropZoneColumnComp.prototype.createAggSelect = function (hidePopup, value) {\n    var _this = this;\n\n    var itemSelected = function itemSelected() {\n      hidePopup();\n\n      if (_this.gridOptionsWrapper.isFunctionsPassive()) {\n        var event_1 = {\n          type: ag_grid_community_1.Events.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST,\n          columns: [_this.column],\n          aggFunc: value,\n          api: _this.gridApi,\n          columnApi: _this.columnApi\n        };\n\n        _this.eventService.dispatchEvent(event_1);\n      } else {\n        _this.columnController.setColumnAggFunc(_this.column, value, \"toolPanelDragAndDrop\");\n      }\n    };\n\n    var localeTextFunc = this.gridOptionsWrapper.getLocaleTextFunc();\n    var aggFuncString = value.toString();\n    var aggFuncStringTranslated = localeTextFunc(aggFuncString, aggFuncString);\n    var comp = new AggItemComp(itemSelected, aggFuncStringTranslated);\n    return comp;\n  };\n\n  DropZoneColumnComp.EVENT_COLUMN_REMOVE = 'columnRemove';\n  DropZoneColumnComp.TEMPLATE = \"<span class=\\\"ag-column-drop-cell\\\">\\n          <span class=\\\"ag-column-drag\\\" ref=\\\"eDragHandle\\\"></span>\\n          <span class=\\\"ag-column-drop-cell-text\\\"></span>\\n          <span class=\\\"ag-column-drop-cell-button\\\">&#10006;</span>\\n        </span>\";\n\n  __decorate([ag_grid_community_1.Autowired('dragAndDropService'), __metadata(\"design:type\", ag_grid_community_1.DragAndDropService)], DropZoneColumnComp.prototype, \"dragAndDropService\", void 0);\n\n  __decorate([ag_grid_community_1.Autowired('columnController'), __metadata(\"design:type\", ag_grid_community_1.ColumnController)], DropZoneColumnComp.prototype, \"columnController\", void 0);\n\n  __decorate([ag_grid_community_1.Autowired('popupService'), __metadata(\"design:type\", ag_grid_community_1.PopupService)], DropZoneColumnComp.prototype, \"popupService\", void 0);\n\n  __decorate([ag_grid_community_1.Autowired('aggFuncService'), __metadata(\"design:type\", aggFuncService_1.AggFuncService)], DropZoneColumnComp.prototype, \"aggFuncService\", void 0);\n\n  __decorate([ag_grid_community_1.Autowired('gridOptionsWrapper'), __metadata(\"design:type\", ag_grid_community_1.GridOptionsWrapper)], DropZoneColumnComp.prototype, \"gridOptionsWrapper\", void 0);\n\n  __decorate([ag_grid_community_1.Autowired('eventService'), __metadata(\"design:type\", ag_grid_community_1.EventService)], DropZoneColumnComp.prototype, \"eventService\", void 0);\n\n  __decorate([ag_grid_community_1.Autowired('columnApi'), __metadata(\"design:type\", ag_grid_community_1.ColumnApi)], DropZoneColumnComp.prototype, \"columnApi\", void 0);\n\n  __decorate([ag_grid_community_1.Autowired('gridApi'), __metadata(\"design:type\", ag_grid_community_1.GridApi)], DropZoneColumnComp.prototype, \"gridApi\", void 0);\n\n  __decorate([ag_grid_community_1.QuerySelector('.ag-column-drop-cell-text'), __metadata(\"design:type\", HTMLElement)], DropZoneColumnComp.prototype, \"eText\", void 0);\n\n  __decorate([ag_grid_community_1.QuerySelector('.ag-column-drop-cell-button'), __metadata(\"design:type\", HTMLElement)], DropZoneColumnComp.prototype, \"btRemove\", void 0);\n\n  __decorate([ag_grid_community_1.RefSelector('eDragHandle'), __metadata(\"design:type\", HTMLElement)], DropZoneColumnComp.prototype, \"eDragHandle\", void 0);\n\n  __decorate([ag_grid_community_1.PostConstruct, __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", []), __metadata(\"design:returntype\", void 0)], DropZoneColumnComp.prototype, \"init\", null);\n\n  return DropZoneColumnComp;\n}(ag_grid_community_1.Component);\n\nexports.DropZoneColumnComp = DropZoneColumnComp;\n\nvar AggItemComp =\n/** @class */\nfunction (_super) {\n  __extends(AggItemComp, _super);\n\n  function AggItemComp(itemSelected, value) {\n    var _this = _super.call(this, '<div class=\"ag-select-agg-func-item\"/>') || this;\n\n    _this.getGui().innerText = value;\n    _this.value = value;\n\n    _this.addGuiEventListener('click', itemSelected);\n\n    return _this;\n  }\n\n  return AggItemComp;\n}(ag_grid_community_1.Component);","map":null,"metadata":{},"sourceType":"script"}